<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../../doc/otp_doc.css" type="text/css">
<title>Erlang -- Time and Time Correction in Erlang</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../../doc/js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../../doc/js/erlresolvelinks.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function getWinHeight() {
                var myHeight = 0;
                if( typeof( window.innerHeight ) == 'number' ) {
                  //Non-IE
                  myHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth ||
                                                         document.documentElement.clientHeight ) ) {
                  //IE 6+ in 'standards compliant mode'
                  myHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                  //IE 4 compatible
                  myHeight = document.body.clientHeight;
                }
                return myHeight;
              }

              function setscrollpos() {
                var objf=document.getElementById('loadscrollpos');
                 document.getElementById("leftnav").scrollTop = objf.offsetTop - getWinHeight()/2;
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //--></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../../../doc/erlang-logo.png"><br><small><a href="users_guide.html">User's Guide</a><br><a href="index.html">Reference Manual</a><br><a href="release_notes.html">Release Notes</a><br><a href="../pdf/erts-7.1.pdf">PDF</a><br><a href="../../../doc/index.html">Top</a></small><p><strong>Erlang Run-Time System Application (ERTS)</strong><br><strong>User's Guide</strong><br><small>Version 7.1</small></p>
<br><a href="javascript:openAllFlips()">Expand All</a><br><a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagepath="../../../doc/js/flipmenu">
<li id="no" title="Communication in Erlang" expanded="false">Communication in Erlang<ul>
<li><a href="communication.html">
              Top of chapter
            </a></li>
<li title="Passing of Signals"><a href="communication.html#id68409">Passing of Signals</a></li>
<li title="Synchronous Communication"><a href="communication.html#id60830">Synchronous Communication</a></li>
<li title="Implementation"><a href="communication.html#id76185">Implementation</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Time and Time Correction in Erlang" expanded="true">Time and Time Correction in Erlang<ul>
<li><a href="time_correction.html">
              Top of chapter
            </a></li>
<li title="New Extended Time Functionality"><a href="time_correction.html#id61299">New Extended Time Functionality</a></li>
<li title="Some Terminology"><a href="time_correction.html#id56705">Some Terminology</a></li>
<li title="Introduction"><a href="time_correction.html#id69683">Introduction</a></li>
<li title="Time Correction"><a href="time_correction.html#id59162">Time Correction</a></li>
<li title="Time Warp Safe Code"><a href="time_correction.html#id59664">Time Warp Safe Code</a></li>
<li title="Time Warp Modes"><a href="time_correction.html#id73236">Time Warp Modes</a></li>
<li title="The New Time API"><a href="time_correction.html#id61356">The New Time API</a></li>
<li title="Supporting Both New and Old OTP Releases"><a href="time_correction.html#id62299">Supporting Both New and Old OTP Releases</a></li>
</ul>
</li>
<li id="no" title="Match specifications in Erlang" expanded="false">Match specifications in Erlang<ul>
<li><a href="match_spec.html">
              Top of chapter
            </a></li>
<li title="Grammar"><a href="match_spec.html#id62768">Grammar</a></li>
<li title="Function descriptions"><a href="match_spec.html#id73841">Function descriptions</a></li>
<li title="Variables and literals"><a href="match_spec.html#id82421">Variables and literals</a></li>
<li title="Execution of the match"><a href="match_spec.html#id82824">Execution of the match</a></li>
<li title="Differences between match specifications in ETS and tracing"><a href="match_spec.html#id82929">Differences between match specifications in ETS and tracing</a></li>
<li title="Examples"><a href="match_spec.html#id82968">Examples</a></li>
</ul>
</li>
<li id="no" title="How to interpret the Erlang crash dumps" expanded="false">How to interpret the Erlang crash dumps<ul>
<li><a href="crash_dump.html">
              Top of chapter
            </a></li>
<li title="General information"><a href="crash_dump.html#id83250">General information</a></li>
<li title="Scheduler information"><a href="crash_dump.html#id83520">Scheduler information</a></li>
<li title="Memory information"><a href="crash_dump.html#id83673">Memory information</a></li>
<li title="Internal table information"><a href="crash_dump.html#id83699">Internal table information</a></li>
<li title="Allocated areas"><a href="crash_dump.html#id83724">Allocated areas</a></li>
<li title="Allocator"><a href="crash_dump.html#id83750">Allocator</a></li>
<li title="Process information"><a href="crash_dump.html#id83790">Process information</a></li>
<li title="Port information"><a href="crash_dump.html#id84124">Port information</a></li>
<li title="ETS tables"><a href="crash_dump.html#id84140">ETS tables</a></li>
<li title="Timers"><a href="crash_dump.html#id84317">Timers</a></li>
<li title="Distribution information"><a href="crash_dump.html#id84372">Distribution information</a></li>
<li title="Loaded module information"><a href="crash_dump.html#id84496">Loaded module information</a></li>
<li title="Fun information"><a href="crash_dump.html#id84587">Fun information</a></li>
<li title="Process Data"><a href="crash_dump.html#id84659">Process Data</a></li>
<li title="Atoms"><a href="crash_dump.html#id84735">Atoms</a></li>
<li title="Disclaimer"><a href="crash_dump.html#id84751">Disclaimer</a></li>
</ul>
</li>
<li id="no" title="How to implement an alternative carrier for  the Erlang distribution" expanded="false">How to implement an alternative carrier for  the Erlang distribution<ul>
<li><a href="alt_dist.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="alt_dist.html#id84871">Introduction</a></li>
<li title="The driver"><a href="alt_dist.html#id84961">The driver</a></li>
<li title="Putting it all together"><a href="alt_dist.html#id86211">Putting it all together</a></li>
</ul>
</li>
<li id="no" title="The Abstract Format" expanded="false">The Abstract Format<ul>
<li><a href="absform.html">
              Top of chapter
            </a></li>
<li title="Module declarations and forms"><a href="absform.html#id86491">Module declarations and forms</a></li>
<li title="Atomic literals"><a href="absform.html#id87376">Atomic literals</a></li>
<li title="Patterns"><a href="absform.html#id87438">Patterns</a></li>
<li title="Expressions"><a href="absform.html#id87653">Expressions</a></li>
<li title="Clauses"><a href="absform.html#id88467">Clauses</a></li>
<li title="Guards"><a href="absform.html#id88687">Guards</a></li>
<li title="The abstract format after preprocessing"><a href="absform.html#id88962">The abstract format after preprocessing</a></li>
</ul>
</li>
<li id="no" title="tty - A command line interface" expanded="false">tty - A command line interface<ul>
<li><a href="tty.html">
              Top of chapter
            </a></li>
<li title="Normal Mode"><a href="tty.html#id89135">Normal Mode</a></li>
<li title="Shell Break Mode"><a href="tty.html#id89655">Shell Break Mode</a></li>
</ul>
</li>
<li id="no" title="How to implement a driver" expanded="false">How to implement a driver<ul>
<li><a href="driver.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="driver.html#id89780">Introduction</a></li>
<li title="Sample driver"><a href="driver.html#id89812">Sample driver</a></li>
<li title="Compiling and linking the sample driver"><a href="driver.html#id90214">Compiling and linking the sample driver</a></li>
<li title="Calling a driver as a port in Erlang"><a href="driver.html#id90250">Calling a driver as a port in Erlang</a></li>
<li title="Sample asynchronous driver"><a href="driver.html#id90357">Sample asynchronous driver</a></li>
<li title="An asynchronous driver using driver_async"><a href="driver.html#id90631">An asynchronous driver using driver_async</a></li>
</ul>
</li>
<li id="no" title="Inet configuration" expanded="false">Inet configuration<ul>
<li><a href="inet_cfg.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="inet_cfg.html#id90895">Introduction</a></li>
<li title="Configuration Data"><a href="inet_cfg.html#id90999">Configuration Data</a></li>
<li title="User Configuration Example"><a href="inet_cfg.html#id91876">User Configuration Example</a></li>
</ul>
</li>
<li id="no" title="External Term Format" expanded="false">External Term Format<ul>
<li><a href="erl_ext_dist.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="erl_ext_dist.html#id91977">Introduction</a></li>
<li title="Distribution header"><a href="erl_ext_dist.html#id92325">Distribution header</a></li>
<li title="ATOM_CACHE_REF"><a href="erl_ext_dist.html#id92930">ATOM_CACHE_REF</a></li>
<li title="SMALL_INTEGER_EXT"><a href="erl_ext_dist.html#id93005">SMALL_INTEGER_EXT</a></li>
<li title="INTEGER_EXT"><a href="erl_ext_dist.html#id93069">INTEGER_EXT</a></li>
<li title="FLOAT_EXT"><a href="erl_ext_dist.html#id93133">FLOAT_EXT</a></li>
<li title="ATOM_EXT"><a href="erl_ext_dist.html#id93208">ATOM_EXT</a></li>
<li title="REFERENCE_EXT"><a href="erl_ext_dist.html#id93307">REFERENCE_EXT</a></li>
<li title="PORT_EXT"><a href="erl_ext_dist.html#id93465">PORT_EXT</a></li>
<li title="PID_EXT"><a href="erl_ext_dist.html#id93584">PID_EXT</a></li>
<li title="SMALL_TUPLE_EXT"><a href="erl_ext_dist.html#id93728">SMALL_TUPLE_EXT</a></li>
<li title="LARGE_TUPLE_EXT"><a href="erl_ext_dist.html#id93820">LARGE_TUPLE_EXT</a></li>
<li title="MAP_EXT"><a href="erl_ext_dist.html#id93910">MAP_EXT</a></li>
<li title="NIL_EXT"><a href="erl_ext_dist.html#id94020">NIL_EXT</a></li>
<li title="STRING_EXT"><a href="erl_ext_dist.html#id94071">STRING_EXT</a></li>
<li title="LIST_EXT"><a href="erl_ext_dist.html#id94164">LIST_EXT</a></li>
<li title="BINARY_EXT"><a href="erl_ext_dist.html#id94282">BINARY_EXT</a></li>
<li title="SMALL_BIG_EXT"><a href="erl_ext_dist.html#id94380">SMALL_BIG_EXT</a></li>
<li title="LARGE_BIG_EXT"><a href="erl_ext_dist.html#id94487">LARGE_BIG_EXT</a></li>
<li title="NEW_REFERENCE_EXT"><a href="erl_ext_dist.html#id94590">NEW_REFERENCE_EXT</a></li>
<li title="SMALL_ATOM_EXT"><a href="erl_ext_dist.html#id94762">SMALL_ATOM_EXT</a></li>
<li title="FUN_EXT"><a href="erl_ext_dist.html#id94881">FUN_EXT</a></li>
<li title="NEW_FUN_EXT"><a href="erl_ext_dist.html#id95128">NEW_FUN_EXT</a></li>
<li title="EXPORT_EXT"><a href="erl_ext_dist.html#id95506">EXPORT_EXT</a></li>
<li title="BIT_BINARY_EXT"><a href="erl_ext_dist.html#id95649">BIT_BINARY_EXT</a></li>
<li title="NEW_FLOAT_EXT"><a href="erl_ext_dist.html#id95755">NEW_FLOAT_EXT</a></li>
<li title="ATOM_UTF8_EXT"><a href="erl_ext_dist.html#id95823">ATOM_UTF8_EXT</a></li>
<li title="SMALL_ATOM_UTF8_EXT"><a href="erl_ext_dist.html#id95925">SMALL_ATOM_UTF8_EXT</a></li>
</ul>
</li>
<li id="no" title="Distribution Protocol" expanded="false">Distribution Protocol<ul>
<li><a href="erl_dist_protocol.html">
              Top of chapter
            </a></li>
<li title="EPMD Protocol"><a href="erl_dist_protocol.html#id96142">EPMD Protocol</a></li>
<li title="Distribution Handshake"><a href="erl_dist_protocol.html#id97444">Distribution Handshake</a></li>
<li title="Protocol between connected nodes"><a href="erl_dist_protocol.html#id97838">Protocol between connected nodes</a></li>
<li title="New Ctrlmessages for distrvsn = 1 (OTP R4)"><a href="erl_dist_protocol.html#id98279">New Ctrlmessages for distrvsn = 1 (OTP R4)</a></li>
<li title="New Ctrlmessages for distrvsn = 2"><a href="erl_dist_protocol.html#id98378">New Ctrlmessages for distrvsn = 2</a></li>
<li title="New Ctrlmessages for distrvsn = 3 (OTP R5C)"><a href="erl_dist_protocol.html#id98389">New Ctrlmessages for distrvsn = 3 (OTP R5C)</a></li>
<li title="New Ctrlmessages for distrvsn = 4 (OTP R6)"><a href="erl_dist_protocol.html#id98401">New Ctrlmessages for distrvsn = 4 (OTP R6)</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>2 Time and Time Correction in Erlang</h1>
  

  <h3><a name="id61299">2.1 
        New Extended Time Functionality</a></h3>
    
    <div class="note">
<div class="label">Note</div>
<div class="content"><p><p>As of OTP 18 (ERTS version 7.0) the time functionality of
    Erlang has been extended. This both includes a
    <span class="bold_code"><a href="#The_New_Time_API">new API</a></span>
    for time, as well as
    <span class="bold_code"><a href="#Time_Warp_Modes">time warp
    modes</a></span> which alters the behavior of the system when
    system time changes.</p>
    <p>The <span class="bold_code"><a href="#No_Time_Warp_Mode">default
    time warp mode</a></span> has the same behavior as before, and the
    old API will still work, so you are not required to change
    anything unless you want to. However, <strong>you are strongly
    encouraged to use the new API</strong> instead of the old API based
    on <span class="bold_code"><a href="erlang.html#now-0"><span class="code">erlang:now/0</span></a></span>.
    <span class="code">erlang:now/0</span> has been deprecated since it is and forever
    will be a scalability bottleneck. By using the new API you will
    automatically get scalability and performance improvements. This
    will also enable you to use the
    <span class="bold_code"><a href="#Multi_Time_Warp_Mode">multi time warp mode</a></span>
    which improves accuracy, and precision of time measurements.</p></p></div>
</div>
  

  <h3><a name="id56705">2.2 
        Some Terminology</a></h3>
    
    <p>In order to make it easier to understand this document we first
    define some terminology. This is a mixture of our own terminology
    (Erlang/OS system time, Erlang/OS monotonic time, time warp)
    and globally accepted terminology.</p>

    <a name="Monotonically_Increasing"></a>
    <h4>Monotonically Increasing</h4>
      
      <p>In a monotonically increasing sequence of values, all values
      that have a predecessor are either larger than, or equal to its
      predecessor.</p>
    

    <a name="Strictly_Monotonically_Increasing"></a>
    <h4>Strictly Monotonically Increasing</h4>
      
      <p>In a strictly monotonically increasing sequence of values,
      all values that have a predecessor are larger than its
      predecessor.</p>
    

    <a name="UT1"></a>
    <h4>UT1</h4>
      
      <p>Universal Time. Based on the rotation of the earth. Conceptually
      mean solar time at 0° longitude.</p>
    

    <a name="UTC"></a>
    <h4>UTC</h4>
      
      <p>Coordinated Universal Time. UTC almost align with
      <span class="bold_code"><a href="#UT1">UT1</a></span>, however, UTC uses the
      SI definition of a second which is not exactly of the same length
      as the second used by UT1. This means that UTC slowly drifts from
      UT1. In order to keep UTC relatively in sync with UT1, leap seconds
      are inserted, and potentially also deleted. That is, an UTC day may
      be 86400, 86401, or 86399 seconds long.</p>
    

    <a name="POSIX_Time"></a>
    <h4>POSIX Time</h4>
      
      <p>Time since
      <span class="bold_code"><a href="http://pubs.opengroup.org/onlinepubs/9699919799/xrat/V4_xbd_chap03.html#tag_21_03_00_17">Epoch</a></span>.
      Epoch is defined to be 00:00:00 <span class="bold_code"><a href="#UTC">UTC</a></span>,
      January 1, 1970.
      <span class="bold_code"><a href="http://pubs.opengroup.org/onlinepubs/009604499/basedefs/xbd_chap04.html#tag_04_14">A day in POSIX time</a></span>
      is defined to be exactly 86400 seconds long. Strangely enough
      Epoch is defined to be a time in UTC, and UTC have another
      definition of how long a day is. Quoting the Open Group
      <span class="bold_code"><a href="http://pubs.opengroup.org/onlinepubs/9699919799/xrat/V4_xbd_chap04.html#tag_21_04_15">"POSIX time is therefore not necessarily UTC, despite its appearance"</a></span>. The effect of this is that when an UTC leap second is
      inserted, POSIX time either stops for a second, or repeats the
      last second. If an UTC leap second would be deleted (has never
      happened yet), POSIX time would make a one second leap forward.</p>
    

    <a name="Time_Resolution"></a>
    <h4>Time Resolution</h4>
      
      <p>The shortest time interval that can be distinguished when
      reading time values.</p>
    

    <a name="Time_Precision"></a>
    <h4>Time Precision</h4>
      
      <p>The shortest time interval that can be be distinguished
      repeatedly and reliably when reading time values. Precision
      is limited by the
      <span class="bold_code"><a href="#Time_Resolution">resolution</a></span>, but
      resolution and precision might differ significantly.</p>
    

    <a name="Time_Accuracy"></a>
    <h4>Time Accuracy</h4>
      
      <p>The correctness of time values.</p>
    

    <a name="Time_Warp"></a>
    <h4>Time Warp</h4>
      
      <p>A time warp is a leap forwards or backwards in time. That
      is, the difference of time values taken before and after the
      time warp will not correspond to the actual elapsed time.</p>
    

    <a name="OS_System_Time"></a>
    <h4>OS System Time</h4>
      
      <p>The operating systems view of
      <span class="bold_code"><a href="#POSIX_Time">POSIX time</a></span>. It can be
      retrieved by calling
      <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','kernel','os.html#system_time-0');"><span class="code">os:system_time()</span></a></span>.
      This may or may not be an accurate view of POSIX time. This time
      may typically be adjusted both backwards and forwards without
      limitation. That is, <span class="bold_code"><a href="#Time_Warp">time warps</a></span>
      may be observed. You can get information about the Erlang runtime
      system's source of OS system time by calling
      <span class="bold_code"><a href="erlang.html#system_info_os_system_time_source"><span class="code">erlang:system_info(os_system_time_source)</span></a></span>.</p>
    

    <a name="OS_Monotonic_Time"></a>
    <h4>OS Monotonic Time</h4>
      
      <p>A monotonically increasing time provided by the operating
      system. This time does not leap and have a relatively steady
      frequency although not completely correct. However, it is not
      uncommon that the OS monotonic time stops if the system is
      suspended. This time typically increase since some
      unspecified point in time that is not connected to
      <span class="bold_code"><a href="#OS_System_Time">OS system time</a></span>. Note
      that this type of time is not necessarily provided by all
      operating systems. You can get information about the Erlang
      runtime system's source of OS monotonic time by calling
      <span class="bold_code"><a href="erlang.html#system_info_os_monotonic_time_source"><span class="code">erlang:system_info(os_monotonic_time_source)</span></a></span>.</p>
    

    <a name="Erlang_System_Time"></a>
    <h4>Erlang System Time</h4>
      
      <p>The Erlang runtime systems view of
      <span class="bold_code"><a href="#POSIX_Time">POSIX time</a></span>. It can be
      retrieved by calling
      <span class="bold_code"><a href="erlang.html#system_time-0"><span class="code">erlang:system_time()</span></a></span>.
      This time may or may not be an accurate view of POSIX time, and may
      or may not align with <span class="bold_code"><a href="#OS_System_Time">OS system
      time</a></span>. The runtime system works towards aligning the two
      system times. Depending on <span class="bold_code"><a href="#Time_Warp_Modes">time
      warp mode</a></span> used, this may be achieved by letting the Erlang
      system time perform a <span class="bold_code"><a href="#Time_Warp">time
      warp</a></span>.</p>
    

    <a name="Erlang_Monotonic_Time"></a>
    <h4>Erlang Monotonic Time</h4>
      
      <p>A monotonically increasing time provided by the
      Erlang runtime system. The Erlang monotonic time increase since
      some unspecified point in time. It can be retrieved by calling
      <span class="bold_code"><a href="erlang.html#monotonic_time-0"><span class="code">erlang:monotonic_time()</span></a></span>.
      The
      <span class="bold_code"><a href="#Time_Accuracy">accuracy</a></span>, and
      <span class="bold_code"><a href="#Time_Precision">precision</a></span> of Erlang
      monotonic time heavily depends on the accuracy and precision of
      <span class="bold_code"><a href="#OS_Monotonic_Time">OS monotonic time</a></span>,
      the accuracy and precision of
      <span class="bold_code"><a href="#OS_System_Time">OS system time</a></span> as well
      as on the
      <span class="bold_code"><a href="#Time_Warp_Modes">time warp mode</a></span>
      used. On a system that is lacking OS monotonic time, the Erlang
      monotonic time can only guarantee monotonicity and can more or less
      not give any other guarantees. The frequency adjustments made to
      the Erlang monotonic time depends on the time warp mode
      used.</p>

      <p>Internally in the runtime system the Erlang monotonic
      time is the "time engine" that is used for more or less
      everything that has anything to do with time. All timers
      regardless of it is a <span class="code">receive ... after</span> timer, BIF timer,
      or a timer in the <span class="code">timer</span> module are triggered
      relative Erlang monotonic time. Even
      <span class="bold_code"><a href="#Erlang_System_Time">Erlang system
      time</a></span> is based on Erlang monotonic time.
      By adding current Erlang monotonic time with current time
      offset you get current Erlang system time. Current time
      offset can be retrieved by calling
      <span class="bold_code"><a href="erlang.html#time_offset-0"><span class="code">erlang:time_offset/0</span></a></span>.
      </p>
    

  

  <h3><a name="id69683">2.3 
        Introduction</a></h3>
    

  <p>Time is vital to an Erlang program and, more importantly, <strong>correct</strong>
  time is vital to an Erlang program. As Erlang is a language with
  soft real time properties and we have the possibility to express
  time in our programs, the Virtual Machine and the language has to be
  very careful about what is considered a correct point in time and in
  how time functions behave.</p>

  <p>In the beginning, Erlang was constructed assuming that the wall
  clock time in the system showed a monotonic time moving forward at
  exactly the same pace as the definition of time. That more or less
  meant that an atomic clock (or better) was expected to be attached
  to your hardware and that the hardware was then expected to be
  locked away from any human (or unearthly) tinkering for all
  eternity. While this might be a compelling thought, it's simply
  never the case.</p>

  <p>A "normal" modern computer can not keep time. Not on itself and
  not unless you actually have a chip level atomic clock wired to
  it. Time, as perceived by your computer, will normally need to be
  corrected. Hence the NTP protocol that together with the ntpd
  process will do it's best to keep your computers time in sync with
  the "real" time in the universe. Between NTP corrections, usually a
  less potent time-keeper than an atomic clock is used.</p>

  <p>But NTP is not fail safe. The NTP server can be unavailable, the
  ntp.conf can be wrongly configured or your computer may from time to
  time be disconnected from the internet. Furthermore you can have a
  user (or even system administrator) on your system that thinks the
  right way to handle daylight saving time is to adjust the clock one
  hour two times a year (a tip, that is not the right way to do
  it...). To further complicate things, this user fetched your
  software from the internet and has never ever thought about what's
  the correct time as perceived by a computer. The user simply does
  not care about keeping the wall clock in sync with the rest of the
  universe. The user expects your program to have omnipotent knowledge
  about the time.</p>

  <p>Most programmers also expect time to be reliable, at least until
  they realize that the wall clock time on their workstation is of by
  a minute. Then they simply set it to the correct time, maybe or
  maybe not in a smooth way. Most probably not in a smooth way.</p>

  <p>The amount of problems that arise when you expect the wall clock
  time on the system to always be correct may be immense. Therefore Erlang
  introduced the "corrected estimate of time", or the "time
  correction" many years ago. The time correction relies on the fact
  that most operating systems have some kind of monotonic clock,
  either a real time extension or some built in "tick counter" that is
  independent of the wall clock settings. This counter may have
  microsecond resolution or much less, but generally it has a drift
  that is not to be ignored.</p>

  

  <a name="Time_Correction"></a>
  <h3><a name="id59162">2.4 
        Time Correction</a></h3>
    
    <p>If time correction is enabled, the Erlang runtime system
    will make use of both
    <span class="bold_code"><a href="#OS_System_Time">OS system time</a></span>
    and <span class="bold_code"><a href="#OS_Monotonic_Time">OS monotonic time</a></span>,
    in order to make adjustments of the frequency of the Erlang
    monotonic clock. Time correction will ensure that
    <span class="bold_code"><a href="#Erlang_Monotonic_Time">Erlang monotonic time</a></span>
    will not warp, and that the frequency is relatively accurate.
    The type of adjustments made to the frequency depends on the
    time warp mode used. This will be discussed in more details in
    the <span class="bold_code"><a href="#Time_Warp_Modes">time warp modes</a></span>
    section below.</p>

    <p>By default time correction will be enabled if support for
    it on the specific platform exist. Support for it includes
    both an OS monotonic time provided by the OS, and an
    implementation in the Erlang runtime system utilizing the
    OS monotonic time. You can check if your system has support
    for OS monotonic time by calling
    <span class="bold_code"><a href="erlang.html#system_info_os_monotonic_time_source"><span class="code">erlang:system_info(os_monotonic_time_source)</span></a></span>,
    and you can check if time correction is enabled on your
    system by calling
    <span class="bold_code"><a href="erlang.html#system_info_time_correction"><span class="code">erlang:system_info(time_correction)</span></a></span>.</p>

    <p>Time correction is enabled or disabled by passing the
    <span class="bold_code"><a href="erl.html#+c"><span class="code">+c [true|false]</span></a></span>
    command line argument to <span class="code">erl</span>.</p>

    <p>If time correction is disabled, Erlang monotonic time
    may warp forwards, it may stop and even freeze for extended
    periods of time, and there are no guarantees that the frequency
    of the Erlang monotonic clock is accurate or stable.</p>

    <p><strong>You typically never want to disable time correction</strong>.
    Previously there was a performance penalty associated with time
    correction, but nowadays it is most often the other way around.
    By disabling time correction you are likely to get bad scalability,
    bad performance, and bad time measurements.</p>
  


  <a name="Time_Warp_Safe_Code"></a>
  <h3><a name="id59664">2.5 
        Time Warp Safe Code</a></h3>
    
    <p>Time warp safe code is code that is able to handle
    a <span class="bold_code"><a href="#Time_Warp">time warp</a></span> of
    <span class="bold_code"><a href="#Erlang_System_Time">Erlang system time</a></span>.
    </p>

    <p><span class="bold_code"><a href="erlang.html#now-0"><span class="code">erlang:now/0</span></a></span>
    behaves very bad when Erlang system time warps. When Erlang
    system time do a time warp backwards, the values returned
    from <span class="code">erlang:now/0</span> will freeze (if you disregard the
    micro second increments made due to the actual call) until
    OS system time reach the point of the last value returned by
    <span class="code">erlang:now/0</span>. This freeze might continue for very
    long periods of time. It might take years, decades,
    and even longer than this until the freeze stops.</p>

    <p>All uses of <span class="code">erlang:now/0</span> are not necessarily
    time warp unsafe. If you do not use it to get time, it
    will be time warp safe. However <strong>all uses of
    <span class="code">erlang:now/0</span> are suboptimal</strong> from a performance
    and scalability perspective. So you really want to replace
    the usage of it with other functionality. For examples
    of how to replace the usage of <span class="code">erlang:now/0</span>,
    see the <span class="bold_code"><a href="#Dos_and_Donts">Dos and Donts</a></span>
    section.</p>
  

  <a name="Time_Warp_Modes"></a>
  <h3><a name="id73236">2.6 
        Time Warp Modes</a></h3>
    

    <p>Current <span class="bold_code"><a href="#Erlang_System_Time">Erlang system
    time</a></span> is determined by adding current
    <span class="bold_code"><a href="erlang.html#monotonic_time-0">Erlang monotonic time</a></span>
    with current
    <span class="bold_code"><a href="erlang.html#time_offset-0">time offset</a></span>. The
    time offset is managed differently depending on which time
    warp mode you use. The time warp mode is set by passing the
    <span class="bold_code"><a href="erl.html#+C_"><span class="code">+C
    [no_time_warp|single_time_warp|multi_time_warp]</span></a></span>
    command line argument to <span class="code">erl</span>.</p>

    <a name="No_Time_Warp_Mode"></a>
    <h4>No Time Warp Mode</h4>
      
      <p>The time offset is determined at runtime system start
      and will after this not change. This is the default behavior.
      Not because it is the best mode (which it isn't). It is
      default <strong>only</strong> because this is how the runtime system
      always has behaved up until ERTS version 7.0, and you have to
      ensure that your Erlang code that may execute during a time
      warp is <span class="bold_code"><a href="#Time_Warp_Safe_Code">time warp
      safe</a></span> before you can enable other modes.</p>

      <p>Since the time offset is not allowed to change, time
      correction needs to adjust the frequency of the Erlang
      monotonic clock in order to smoothly align Erlang system
      time with OS system time. A big downside of this approach
      is that we on purpose will use a faulty frequency on the
      Erlang monotonic clock if adjustments are needed. This
      error may be as big as 1%. This error will show up in all
      time measurements in the runtime system.</p>

      <p>If time correction is not enabled, the Erlang monotonic
      time will freeze when the OS system time leap backwards.
      The freeze of the monotonic time will continue until
      OS system time catch up. The freeze may continue for
      a very long time. When OS system time leaps forwards,
      Erlang monotonic time will also leap forward.</p>
    

    <a name="Single_Time_Warp_Mode"></a>
    <h4>Single Time Warp Mode</h4>
      
      <p>This mode is more or less a backwards compatibility mode
      as of its introduction.</p>
      <p>On an embedded system it is not uncommon that the system
      has no power supply at all, not even a battery, when it is
      shut off. The system clock on such a system will typically
      be way off when the system boots. If the
      <span class="bold_code"><a href="#No_Time_Warp_Mode">no time warp mode</a></span>
      is used, and the Erlang runtime system is started before
      the OS system time has been corrected, the Erlang system
      time may be wrong for a very long time, even centuries or
      more.</p>
      <p>If you for some reason need to use Erlang code that
      is not
      <span class="bold_code"><a href="#Time_Warp_Safe_Code">time warp safe</a></span>,
      and you need to start the Erlang runtime system before the OS
      system time has been corrected, you may want to use the single
      time warp mode. Note that there are limitations to when you can
      execute time warp unsafe code using this mode. If it is possible
      to only utilize time warp safe code, it is <strong>much</strong> better
      to use the <span class="bold_code"><a href="#Multi_Time_Warp_Mode">multi time
      warp mode</a></span> instead.
      </p>

      <p>Using the single time warp mode, the time offset is
      handled in two phases:</p>

      <dl>
	<dt><strong>Preliminary Phase</strong></dt>
	<dd>
	  <p>The preliminary phase starts when the runtime
	  system starts. A preliminary time offset based on
	  current OS system time is determined. This offset will
	  from now on be fixed during the whole preliminary phase.</p>

	  <p>If time correction is enabled, adjustments to the
	  Erlang monotonic clock will be made to keep its
	  frequency as correct as possible, but <strong>no</strong>
	  adjustments will be made trying to align Erlang system
	  time and OS system time. That is, during the preliminary
	  Erlang system time and OS system time might diverge
	  from each other, and no attempt to prevent this will
	  be made.</p>

	  <p>If time correction is disabled, changes in OS system
	  time will effect the monotonic clock the same way as
	  when the <span class="bold_code"><a href="#No_Time_Warp_Mode">no time warp
	  mode</a></span> is used.</p>
	</dd>

	<dt><strong>Final Phase</strong></dt>
	<dd>

	  <p>The final phase begin when the user finalize the time
	  offset by calling
	  <span class="bold_code"><a href="erlang.html#system_flag_time_offset"><span class="code">erlang:system_flag(time_offset, finalize)</span></a></span>.
	  The finalization can only be performed once.
	  </p>

	  <p>During finalization, the time offset is adjusted and
	  fixated so that current Erlang system time align with
	  current OS system time. Since the time offset may
	  change during the finalization, the Erlang system time
	  may do a time warp at this point. The time offset will
	  from now on be fixed until the runtime system terminates.
	  If time correction has been enabled, the time
	  correction will from now on also make adjustments
	  in order to align Erlang system time with OS system
	  time. When the system is in the final phase it behaves
	  exactly as in the <span class="bold_code"><a href="#No_Time_Warp_Mode">no
	  time warp mode</a></span>.</p>

	</dd>
      </dl>

      <p>In order for this to work properly there are two
      requirements that the user needs to ensure are
      satisfied:</p>

      <dl>
	<dt><strong>Forward Time Warp</strong></dt>
	<dd><p>The time warp made when finalizing the time offset
	can only be done forwards without encountering problems.
	This implies that the user has to ensure that the OS
	system time is set to a time earlier or equal to actual
	POSIX time before starting the Erlang runtime system. If
	you are not completely sure the OS system time is correct,
	set it to a time that is guaranteed to be earlier than
	actual POSIX time before starting the Erlang runtime
	system just to be safe.</p></dd>

	<dt><strong>Finalize Correct OS System Time</strong></dt>
	<dd><p>The OS system time needs to be correct when the
	the user finalizes the time offset.</p></dd>
      </dl>

      <p>If these requirements are not fulfilled, the system
      may behave very bad.
      </p>

      <p>Assuming that the requirements above are fulfilled,
      time correction is enabled, and that the OS system time
      is adjusted using some time adjustment protocol like NTP
      or similar, only small adjustments of the Erlang monotonic
      time should be needed in order to keep system times
      aligned after finilization. As long as the system is not
      suspended, the largest adjustments needed should be for
      inserted (or deleted) leap seconds.</p>

      <div class="warning">
<div class="label">Warning</div>
<div class="content"><p><p>In order to be able to use this mode you have
      to ensure that all Erlang code that will execute in
      both phases are
      <span class="bold_code"><a href="#Time_Warp_Safe_Code">time warp
      safe</a></span>.</p>
      <p>Code that only execute in the final phase does not have
      to be able to cope with the time warp.</p></p></div>
</div>

    

    <a name="Multi_Time_Warp_Mode"></a>
    <h4>Multi Time Warp Mode</h4>
      

      <p><strong>Multi time warp mode in combination with time
      correction is the preferred configuration</strong>. This since,
      on almost all platforms, the Erlang runtime system will have
      better performance, will scale better, will behave better,
      and since the accuracy, and precision of time measurements
      will be better. Only Erlang runtime systems executing on
      ancient platforms will benefit from another configuration.</p>

      <p>The time offset may change at any time without limitations.
      That is, Erlang system time may perform time warps both
      forwards and backwards at <strong>any</strong> time. Since we align
      the Erlang system time with the OS system time by changing
      the time offset, we can enable a time correction that tries
      to adjust the frequency of the Erlang monotonic clock to be as
      correct as possible. This will make time measurements using
      the Erlang monotonic time more accurate and precise.</p>

      <p>If time correction is disabled, Erlang monotonic time
      will leap forward if OS system time leaps forward. If the
      OS system time leaps backwards, Erlang monotonic time will
      stop briefly but it does not freeze for extended periods
      of time. This since the time offset is changed in order to
      align Erlang system time with OS system time.</p>

      <div class="warning">
<div class="label">Warning</div>
<div class="content"><p><p>In order to be able to use this mode you have
      to ensure that all Erlang code that will execute on the
      runtime system is
      <span class="bold_code"><a href="#Time_Warp_Safe_Code">time warp
      safe</a></span>.</p></p></div>
</div>
    
  

  <a name="The_New_Time_API"></a>
  <h3><a name="id61356">2.7 
        The New Time API</a></h3>
    

    <p>The old time API is based on
    <span class="bold_code"><a href="erlang.html#now-0"><span class="code">erlang:now/0</span></a></span>.
    The major issue with <span class="code">erlang:now/0</span> is that it was
    intended to be used for so many unrelated things. This
    tied these unrelated operations together and unnecessarily
    caused performance, scalability as well as accuracy, and
    precision issues for operations that do not need to have
    such issues. The new API spreads different functionality
    over multiple functions in order to improve on this.</p>

    <p>In order to be backwards compatible <span class="code">erlang:now/0</span> will
    remain as is, but <strong>you are strongly discouraged from using
    it</strong>. A lot of uses of <span class="code">erlang:now/0</span> will also
    prevent you from using the new
    <span class="bold_code"><a href="#Multi_Time_Warp_Mode">multi time warp
    mode</a></span> which is an important part of this
    new time functionality improvement.</p>

    <p>Some of the new BIFs on some systems, perhaps surprisingly,
    return negative integer values on a newly started run time
    system. This is not a bug, but a memory usage optimization.</p>

    <p>The new API consists of a number of new BIFs:</p>
    <ul>
      <li><p><span class="bold_code"><a href="erlang.html#convert_time_unit-3"><span class="code">erlang:convert_time_unit/3</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#monotonic_time-0"><span class="code">erlang:monotonic_time/0</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#monotonic_time-1"><span class="code">erlang:monotonic_time/1</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_time-0"><span class="code">erlang:system_time/0</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_time-1"><span class="code">erlang:system_time/1</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#time_offset-0"><span class="code">erlang:time_offset/0</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#time_offset-1"><span class="code">erlang:time_offset/1</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#timestamp-0"><span class="code">erlang:timestamp/0</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#unique_integer-0"><span class="code">erlang:unique_integer/0</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#unique_integer-1"><span class="code">erlang:unique_integer/1</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="javascript:erlhref('../../../doc/../','kernel','os.html#system_time-0');"><span class="code">os:system_time/0</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="javascript:erlhref('../../../doc/../','kernel','os.html#system_time-1');"><span class="code">os:system_time/1</span></a></span></p></li>
    </ul>
    <p>and a number of extensions of existing BIFs:</p>
    <ul>
      <li><p><span class="bold_code"><a href="erlang.html#monitor-2"><span class="code">erlang:monitor(time_offset, clock_service)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_flag_time_offset"><span class="code">erlang:system_flag(time_offset, finalize)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_info_os_monotonic_time_source"><span class="code">erlang:system_info(os_monotonic_time_source)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_info_os_system_time_source"><span class="code">erlang:system_info(os_system_time_source)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_info_time_offset"><span class="code">erlang:system_info(time_offset)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_info_time_warp_mode"><span class="code">erlang:system_info(time_warp_mode)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_info_time_correction"><span class="code">erlang:system_info(time_correction)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_info_start_time"><span class="code">erlang:system_info(start_time)</span></a></span></p></li>
      <li><p><span class="bold_code"><a href="erlang.html#system_info_end_time"><span class="code">erlang:system_info(end_time)</span></a></span></p></li>
    </ul>

    <a name="The_New_Erlang_Monotonic_Time"></a>
    <h4>The New Erlang Monotonic Time</h4>
      
      <p>The Erlang monotonic time as such is new as of ERTS
      version 7.0. It has been introduced in order to be able
      to detach time measurements such as elapsed time from
      calender time. It is very common that one is interested
      in measuring elapsed time or specifying a time relative
      to another point in time without having any need to know
      what the involved times are in UTC or any other
      globally defined time scale. By introducing a time scale
      that has a local definition of where it starts, it is
      possible to manage time that do not concern calender
      time on that time scale. Erlang monotonic time use
      such a time scale with a locally defined start.</p>

      <p>The introduction of Erlang monotonic time gives us
      the possibility to adjust the two Erlang times (Erlang
      monotonic time and Erlang system time) separately. By
      doing this, accuracy of elapsed time does not have to
      suffer just because the system time happened to be
      wrong at some point in time. Separate adjustments
      of the two times are only performed in the time warp
      modes, and only fully separated in the
      <span class="bold_code"><a href="#Multi_Time_Warp_Mode">multi
      time warp mode</a></span>. All other modes than the
      multi time warp mode are there for backwards
      compatibility reasons, and when using these the
      accuracy of Erlang monotonic time suffer since
      the adjustments of Erlang monotonic time in these
      modes are more or less tied to the Erlang system
      time.</p>

      <p>The adjustment of system time could have been made
      smother than using a time warp approach, but we think
      that would be a bad choice. Since we are able to
      express and measure time that aren't connected to
      calender time by the use of Erlang monotonic time, it
      is better to expose the change in Erlang system time
      immediately. This since it makes it possible for the
      Erlang applications executing on the system to react
      on the change in system time as soon as possible. This
      is also more or less exactly how most OSes handle this
      (OS monotonic time and OS system time). By adjusting
      system time smoothly we would just hide the fact that
      system time changed and make it harder for the Erlang
      applications to react to the change in a sensible way.</p>

      <p>In order to be able to react to a change in Erlang
      system time you have to be able to detect that it
      happened. The change in Erlang system time occurs when
      current time offset is changed. We have therefore
      introduced the possibility to monitor the time offset
      using
      <span class="bold_code"><a href="erlang.html#monitor-2"><span class="code">erlang:monitor(time_offset, clock_service)</span></a></span>. A process monitoring the time
      offset will be sent a message on the following format
      when the time offset is changed:</p>
      <div class="example"><pre>{'CHANGE', MonitorReference, time_offset, clock_service, NewTimeOffset}</pre></div>
    

    <a name="Unique_Values"></a>
    <h4>Unique Values</h4>
      
      <p>Besides reporting time <span class="code">erlang:now/0</span> also
      produce unique and strictly monotonically increasing
      values. In order to detach this functionality from
      time measurements we have introduced
      <span class="bold_code"><a href="erlang.html#unique_integer-1"><span class="code">erlang:unique_integer()</span></a></span>.
      </p>
    

    <a name="Dos_and_Donts"></a>
    <h4>Dos and Don'ts</h4>
      
      <p>Previously <span class="code">erlang:now/0</span> was the only option for doing
      quite a lot of things. We will look at a few different things
      <span class="code">erlang:now/0</span> could be used for, and how you want to do
      this using the new API:</p>

      <a name="Dos_and_Donts_Retrieve_Erlang_System_Time"></a>
      <h4>Retrieve Erlang System Time</h4>
	
	<div class="dont">
<div class="label">Don't</div>
<div class="content"><p>
	  <p>
	    use <span class="code">erlang:now/0</span> in order to retrieve current Erlang
	    system time.
	  </p>
	</p></div>
</div>
	<div class="do">
<div class="label">Do</div>
<div class="content"><p>
	  <p>
	    use
	    <span class="bold_code"><a href="erlang.html#system_time-1"><span class="code">erlang:system_time/1</span></a></span>
	    in order to retrieve current Erlang system time on the
	    <span class="bold_code"><a href="erlang.html#type_time_unit">time unit</a></span>
	    of your choice.</p>
	    <p>If you want the same format as returned by <span class="code">erlang:now/0</span>, use
	    <span class="bold_code"><a href="erlang.html#timestamp-0"><span class="code">erlang:timestamp/0</span></a></span>.
	    </p>
	</p></div>
</div>
      

      <a name="Dos_and_Donts_Measure_Elapsed_Time"></a>
      <h4>Measure Elapsed Time</h4>
	
	<div class="dont">
<div class="label">Don't</div>
<div class="content"><p>
	  <p>
	    take timestamps with <span class="code">erlang:now/0</span> and calculate
	    the difference in time with
	    <span class="bold_code"><a href="javascript:erlhref('../../../doc/../','stdlib','timer.html#now_diff-2');"><span class="code">timer:now_diff/2</span></a></span>.
	  </p>
	</p></div>
</div>
	<div class="do">
<div class="label">Do</div>
<div class="content"><p>
	  <p>
	    take timestamps with
	    <span class="bold_code"><a href="erlang.html#monotonic_time-0"><span class="code">erlang:monotonic_time/0</span></a></span>
	    and calculate the time difference using ordinary subtraction.
	    The result will be in <span class="code">native</span>
	    <span class="bold_code"><a href="erlang.html#type_time_unit">time unit</a></span>.
	    If you want to convert the
	    result to another time unit you can do this using
	    <span class="bold_code"><a href="erlang.html#convert_time_unit-3"><span class="code">erlang:convert_time_unit/3</span></a></span>.
	    </p>
	    <p>Another easier way of doing this is to use
	    <span class="bold_code"><a href="erlang.html#monotonic_time-1"><span class="code">erlang:monotonic_time/1</span></a></span>
	    with desired time unit. However, you may lose accuracy,
	    and precision this way.
	    </p>
	</p></div>
</div>
      

      <a name="Dos_and_Donts_Determine_Order_of_Events"></a>
      <h4>Determine Order of Events</h4>
	
	<div class="dont">
<div class="label">Don't</div>
<div class="content"><p>
	  <p>
	    determine the order of events by saving a timestamp
	    with <span class="code">erlang:now/0</span> when the event happens.
	  </p>
	</p></div>
</div>
	<div class="do">
<div class="label">Do</div>
<div class="content"><p>
	  <p>
	    determine the order of events by saving the integer
	    returned by
	    <span class="bold_code"><a href="erlang.html#unique_integer-1"><span class="code">erlang:unique_integer([monotonic])</span></a></span>
	    when the event happens. These integers will be strictly
	    monotonically ordered on current runtime system instance
	    corresponding to creation time.
	  </p>
	</p></div>
</div>
      

      <a name="Dos_and_Donts_Determine_Order_of_Events_With_Time_of_the_Event"></a>
      <h4>Determine Order of Events With Time of the Event</h4>
	
	<div class="dont">
<div class="label">Don't</div>
<div class="content"><p>
	  <p>
	    determine the order of events by saving a timestamp
	    with <span class="code">erlang:now/0</span> when the event happens.
	  </p>
	</p></div>
</div>
	<div class="do">
<div class="label">Do</div>
<div class="content"><p>
	  <p>
	    determine the order of events by saving a tuple
	    containing
	    <span class="bold_code"><a href="erlang.html#monotonic_time-0">monotonic time</a></span>
	    and a <span class="bold_code"><a href="erlang.html#unique_integer-1">strictly
	    monotonically increasing integer</a></span> like this:</p>
	    <div class="example"><pre>
Time = erlang:monotonic_time(),
UMI = erlang:unique_integer([monotonic]),
EventTag = {Time, UMI}</pre></div>
	    <p>These tuples will be strictly monotonically ordered
	    on the current runtime system instance according to
	    creation time. Note that it is important that the
	    monotonic time is in the first element (the most
	    significant element when comparing 2-tuples). Using
	    the monotonic time in the tuples, you can calculate time
	    between events.</p>
	    <p>If you are interested in the Erlang system time at the
	    time when the event occurred you can also save the time
	    offset before or after saving the events using
	    <span class="bold_code"><a href="erlang.html#time_offset-0"><span class="code">erlang:time_offset/0</span></a></span>.
	    Erlang monotonic time added with the time
	    offset corresponds to Erlang system time.</p>
	    <p>If you are executing in a mode where time offset
	    may change and you want to be able to get the actual
	    Erlang system time when the event occurred you can
	    save the time offset as a third element in the tuple
	    (the least significant element when comparing 3-tuples).</p>
	</p></div>
</div>
      

      <a name="Dos_and_Donts_Create_a_Unique_Name"></a>
      <h4>Create a Unique Name</h4>
	
	<div class="dont">
<div class="label">Don't</div>
<div class="content"><p>
	  <p>
	    use the values returned from <span class="code">erlang:now/0</span>
	    in order to create a name unique on the current
	    runtime system instance.
	  </p>
	</p></div>
</div>
	<div class="do">
<div class="label">Do</div>
<div class="content"><p>
	  <p>
	    use the value returned from
	    <span class="bold_code"><a href="erlang.html#unique_integer-0"><span class="code">erlang:unique_integer/0</span></a></span>
	    in order to create a name unique on the current runtime system
	    instance. If you only want positive integers, you can use
	    <span class="bold_code"><a href="erlang.html#unique_integer-1"><span class="code">erlang:unique_integer([positive])</span></a></span>.
	  </p>
	</p></div>
</div>
      

      <a name="Dos_and_Donts_Seed_Random_Number_Generation_With_a_Unique_Value"></a>
      <h4>Seed Random Number Generation With a Unique Value</h4>
	
	<div class="dont">
<div class="label">Don't</div>
<div class="content"><p>
	  <p>
	    seed random number generation using <span class="code">erlang:now()</span>.
	  </p>
	</p></div>
</div>
	<div class="do">
<div class="label">Do</div>
<div class="content"><p>
	  <p>
	    seed random number generation using a combination of
	    <span class="bold_code"><a href="erlang.html#monotonic_time-0"><span class="code">erlang:monotonic_time()</span></a></span>,
	    <span class="bold_code"><a href="erlang.html#time_offset-0"><span class="code">erlang:time_offset()</span></a></span>,
	    <span class="bold_code"><a href="erlang.html#unique_integer-0"><span class="code">erlang:unique_integer()</span></a></span>, and other functionality.
	  </p>
	  </p></div>
</div>
      

      <p>To sum this section up: <strong>Don't use <span class="code">erlang:now/0</span>!</strong></p>
    
  

  <a name="Supporting_Both_New_and_Old_OTP_Releases"></a>
  <h3><a name="id62299">2.8 
        Supporting Both New and Old OTP Releases</a></h3>
    
    <p>Your code may be required to be able to run on a variety 
    of OTP installations of different OTP releases. If so, you
    can not just use the new API out of the box, since it will
    not be available on old pre OTP 18 releases. The solution
    is <strong>not</strong> to avoid using the new API, since your
    code then won't be able to benefit from the scalability
    and accuracy improvements made. Instead you want to use the
    new API when available, and fall back on <span class="code">erlang:now/0</span>
    when it is not available. Fortunately almost all of the new
    API can easily be implemented using existing primitives
    (except for
    <span class="bold_code"><a href="erlang.html#system_info_start_time"><span class="code">erlang:system_info(start_time)</span></a></span>,
    <span class="bold_code"><a href="erlang.html#system_info_end_time"><span class="code">erlang:system_info(end_time)</span></a></span>,
    <span class="bold_code"><a href="erlang.html#system_info_os_monotonic_time_source"><span class="code">erlang:system_info(os_monotonic_time_source)</span></a></span>, and
    <span class="bold_code"><a href="erlang.html#system_info_os_system_time_source"><span class="code">erlang:system_info(os_system_time_source)</span></a></span>).
    By wrapping the API with functions that fall back on
    <span class="code">erlang:now/0</span> when the new API is not available,
    and using these wrappers instead of using the API directly
    the problem is solved. These wrappers can for example
    be implemented as in
    <span class="bold_code"><a href="time_compat.erl"><span class="code">$ERL_TOP/erts/example/time_compat.erl</span></a></span>.</p>
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2015 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div></body>
</html>
